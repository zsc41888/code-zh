<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zscä¸¨Android é¡¹ç›®æºç æ•´åˆå·¥å…·ğŸ˜¡</title>
    <!-- ä½¿ç”¨å›½å†… BootCDN åŠ é€ŸåŠ è½½ JSZip -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body { font-family: "Segoe UI", "Microsoft YaHei", sans-serif; margin: 0; background-color: #f5f7fa; color: #333; }
        .container { max-width: 1000px; margin: 40px auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; color: #2c3e50; margin-bottom: 10px; }
        p.subtitle { text-align: center; color: #7f8c8d; margin-bottom: 30px; }

        .control-panel { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }

        /* æ–‡ä»¶ä¸Šä¼ æŒ‰é’®ç¾åŒ– */
        .upload-box {
            position: relative; overflow: hidden; display: inline-block;
        }
        .btn-upload {
            border: none; color: white; background: linear-gradient(135deg, #00C853, #64DD17);
            padding: 15px 40px; border-radius: 50px; font-size: 16px; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0,200,83,0.3); transition: 0.3s;
        }
        .btn-upload:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,200,83,0.4); }
        .upload-box input[type=file] {
            font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
        }

        /* çŠ¶æ€å’Œè¿›åº¦ */
        #status { text-align: center; margin: 15px 0; font-weight: bold; color: #007bff; min-height: 24px; }
        
        /* è¾“å‡ºåŒºåŸŸ */
        .output-area { position: relative; }
        textarea {
            width: 100%; height: 500px; padding: 15px;
            background-color: #282c34; color: #abb2bf; /* ä»£ç ç¼–è¾‘å™¨é£æ ¼ */
            font-family: Consolas, "Courier New", monospace; font-size: 13px;
            border: 1px solid #ddd; border-radius: 8px; resize: vertical;
            white-space: pre; overflow-x: auto; box-sizing: border-box;
        }

        /* åº•éƒ¨æ“ä½œæŒ‰é’® */
        .action-bar { margin-top: 15px; display: flex; justify-content: flex-end; gap: 10px; }
        .btn {
            padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s;
        }
        .btn-copy { background-color: #007bff; color: white; }
        .btn-copy:hover { background-color: #0056b3; }
        .btn-download { background-color: #6c757d; color: white; }
        .btn-download:hover { background-color: #545b62; }
        
        .note { font-size: 12px; color: #999; margin-top: 5px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¤–zscä¸¨ Android æºç æ•´åˆå™¨ğŸ˜‹</h1>
    <p class="subtitle">ä¸Šä¼  Zip -> è‡ªåŠ¨æå– ä»£ç æ–‡ä»¶ è½¬åŒ–ä¸ºç”Ÿæˆ AI å¯è¯»çš„å¼€å‘è¯­è¨€</p>

    <div class="control-panel">
        <div class="upload-box">
            <button class="btn-upload">ğŸ“‚ é€‰æ‹© Android é¡¹ç›®å‹ç¼©åŒ… (.zip)</button>
            <input type="file" id="zipInput" accept=".zip">
        </div>
    </div>

    <div id="status">ç­‰å¾…ä¸Šä¼ ...</div>

    <div class="output-area">
        <textarea id="resultOutput" placeholder="ä»£ç æå–ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
    </div>

    <div class="action-bar">
        <button class="btn btn-download" onclick="downloadTxt()">ğŸ“¥ ä¸‹è½½ä¸º .txt</button>
        <button class="btn btn-copy" onclick="copyToClipboard()">ğŸ“‹ å¤åˆ¶å…¨éƒ¨å†…å®¹</button>
    </div>
    <div class="note">æ³¨æ„ï¼šä¸ºäº†èŠ‚çœä¸å¿…è¦æ—¶é—´ï¼Œå›¾ç‰‡ç­‰äºŒè¿›åˆ¶æ–‡ä»¶åªä¼šæ˜¾ç¤ºè·¯å¾„ï¼Œä½†æ˜¯å¯¹äºAIæ¥è¯´å¹¶æ— å¤§ç¢ğŸ˜‹ã€‚</div>
</div>

<script>
    // å®šä¹‰éœ€è¦ä¿ç•™çš„æ–‡ä»¶æ‰©å±•å (ç™½åå•) - ä»…æ’é™¤å›¾ç‰‡æ–‡ä»¶
    const VALID_EXTENSIONS = [
        'java', 'kt', 'xml', 'gradle', 'properties', 'json', 
        'pro', 'txt', 'md', 'yml', 'yaml', 'cpp', 'h', 'c',
        'java', 'kt', 'xml', 'gradle', 'properties', 'json', 
        'pro', 'txt', 'md', 'yml', 'yaml', 'cpp', 'h', 'c',
        'java', 'kt', 'xml', 'gradle', 'properties', 'json', 
        'pro', 'txt', 'md', 'yml', 'yaml', 'cpp', 'h', 'c'
    ];

    // å®šä¹‰å›¾ç‰‡æ–‡ä»¶æ‰©å±•åï¼ˆéœ€è¦å¿½ç•¥çš„æ–‡ä»¶ï¼‰
    const IMAGE_EXTENSIONS = [
        'png', 'jpg', 'jpeg', 'gif', 'bmp', 'webp', 
        'ico', 'svg', 'tiff', 'tif', 'psd', 'raw',
        'heic', 'heif', 'avif', 'apng', 'jfif', 'pjpeg', 'pjp'
    ];

    // å®šä¹‰éœ€è¦å¿½ç•¥çš„äºŒè¿›åˆ¶/å‹ç¼©æ–‡ä»¶æ‰©å±•å
    const BINARY_EXTENSIONS = [
        'jar', 'aar', 'so', 'dex', 'apk', 'aab',
        'zip', 'rar', '7z', 'tar', 'gz', 'bz2',
        'class', 'o', 'dll', 'exe', 'bin', 'dat',
        'db', 'sqlite', 'mp3', 'mp4', 'wav', 'avi',
        'pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'
    ];

    const zipInput = document.getElementById('zipInput');
    const resultOutput = document.getElementById('resultOutput');
    const statusDiv = document.getElementById('status');

    zipInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (!file) return;

        statusDiv.textContent = "â³ æ­£åœ¨åˆ†æ ZIP ç»“æ„...";
        statusDiv.style.color = "#007bff";
        resultOutput.value = "";

        JSZip.loadAsync(file).then(async function(zip) {
            let combinedCode = "";
            let fileCount = 0;
            let skippedFiles = 0;
            let skippedFileList = [];
            
            // 1. ç”Ÿæˆ AI æç¤ºè¯å¤´éƒ¨
            const headerPrompt = 
`ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„ Android å¼€å‘ä¸“å®¶ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ª Android é¡¹ç›®çš„å®Œæ•´æºç åˆå¹¶æ–‡ä»¶ã€‚
æˆ‘ä¼šæä¾›æ–‡ä»¶çš„è·¯å¾„å’Œå†…å®¹ã€‚
è¯·ä½ å…ˆé˜…è¯»æ•´ä¸ªé¡¹ç›®çš„ç»“æ„å’Œä»£ç é€»è¾‘ï¼Œç†è§£å„æ¨¡å—ä¹‹é—´çš„å…³ç³»ã€‚
é˜…è¯»å®Œæ¯•åï¼Œæ ¹æ®æˆ‘çš„è¦æ±‚å¸®æˆ‘ç”Ÿæˆå¯¹åº”æ–‡ä»¶åº”è¯¥æœ‰çš„ä»£ç 
ä½ çš„å›å¤æ ¼å¼ä¸º:
  (è·¯å¾„)  åº”è¯¥ç›´æ¥è¦†ç›–çš„ä»£ç :
ï¼ˆä»£ç ï¼‰


====== é¡¹ç›®æºç å¼€å§‹ ======
`;
            combinedCode += headerPrompt;

            const promises = [];

            // 2. éå†æ–‡ä»¶
            zip.forEach(function (relativePath, zipEntry) {
                // æ’é™¤æ–‡ä»¶å¤¹æœ¬èº«
                if (zipEntry.dir) return;

                // è·å–æ–‡ä»¶åç¼€
                const ext = relativePath.split('.').pop().toLowerCase();
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯å›¾ç‰‡æ–‡ä»¶
                if (IMAGE_EXTENSIONS.includes(ext) || BINARY_EXTENSIONS.includes(ext)) {
                    // è®°å½•è·³è¿‡çš„æ–‡ä»¶è·¯å¾„
                    skippedFileList.push(relativePath);
                    skippedFiles++;
                    return; // è·³è¿‡å›¾ç‰‡å’ŒäºŒè¿›åˆ¶æ–‡ä»¶
                }

                // è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆæ‰€æœ‰éå›¾ç‰‡æ–‡ä»¶éƒ½è¯»å–ï¼‰
                const promise = zipEntry.async("string").then(content => {
                    return {
                        path: relativePath,
                        content: content,
                        extension: ext
                    };
                }).catch(error => {
                    // å¦‚æœæ— æ³•ä½œä¸ºæ–‡æœ¬è¯»å–ï¼ˆå¯èƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼Œåˆ™è·³è¿‡
                    skippedFileList.push(relativePath + " (äºŒè¿›åˆ¶æ–‡ä»¶)");
                    skippedFiles++;
                    return null;
                });
                
                promises.push(promise);
            });

            statusDiv.textContent = `ğŸ” æ­£åœ¨å¤„ç† ${promises.length} ä¸ªæ–‡ä»¶...`;

            // 3. ç­‰å¾…æ‰€æœ‰æ–‡ä»¶è¯»å–å®Œæˆ
            const results = await Promise.all(promises);

            // 4. æŒ‰è·¯å¾„æ’åºï¼Œä¿è¯ç»“æ„æ¸…æ™°
            const validResults = results.filter(item => item !== null);
            validResults.sort((a, b) => a.path.localeCompare(b.path));

            // 5. æ‹¼æ¥å†…å®¹
            validResults.forEach(item => {
                fileCount++;
                combinedCode += `\n\n============================================\n`;
                combinedCode += `ğŸ“„ æ–‡ä»¶è·¯å¾„: ${item.path}\n`;
                combinedCode += `============================================\n`;
                combinedCode += `${item.content}\n`;
            });

            // 6. æ·»åŠ è·³è¿‡çš„æ–‡ä»¶ä¿¡æ¯ï¼ˆä»…æ˜¾ç¤ºè·¯å¾„ï¼‰
            if (skippedFiles > 0) {
                combinedCode += `\n\n============================================\n`;
                combinedCode += `ğŸš« å·²è·³è¿‡ ${skippedFiles} ä¸ªéæºç æ–‡ä»¶ï¼ˆå›¾ç‰‡/äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰\n`;
                combinedCode += `============================================\n`;
                combinedCode += `ä»¥ä¸‹æ–‡ä»¶å·²è¢«è·³è¿‡ï¼ˆä»…æ˜¾ç¤ºè·¯å¾„ï¼‰ï¼š\n\n`;
                skippedFileList.forEach(filePath => {
                    combinedCode += `- ${filePath}\n`;
                });
            }

            // 7. å°¾éƒ¨æç¤º
            combinedCode += `\n====== é¡¹ç›®æºç ç»“æŸ ======\n`;
            combinedCode += `\næ€»å…±å¤„ç†äº† ${fileCount} ä¸ªæºç æ–‡ä»¶ï¼Œè·³è¿‡äº† ${skippedFiles} ä¸ªéæºç æ–‡ä»¶ã€‚`;
            combinedCode += `\nè¯·æ ¹æ®ä»¥ä¸Šä»£ç ï¼Œåˆ†æé¡¹ç›®ç»“æ„æˆ–å›ç­”æˆ‘çš„é—®é¢˜ã€‚`;

            // 8. æ˜¾ç¤ºç»“æœ
            resultOutput.value = combinedCode;
            statusDiv.textContent = `âœ… æˆåŠŸæå– ${fileCount} ä¸ªæ–‡ä»¶ï¼Œè·³è¿‡ ${skippedFiles} ä¸ªæ–‡ä»¶ï¼ç°åœ¨å¯ä»¥å¤åˆ¶å‘ç»™ AI äº†ã€‚`;
            statusDiv.style.color = "#28a745";

        }).catch(function(e) {
            statusDiv.textContent = "âŒ è§£æå¤±è´¥: " + e.message;
            statusDiv.style.color = "red";
            alert("é”™è¯¯ï¼šè¿™å¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„ ZIP æ–‡ä»¶ï¼Œæˆ–è€…æ–‡ä»¶å·²æŸåã€‚");
        });
    });

    // å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
        const copyText = document.getElementById("resultOutput");
        if (!copyText.value) {
            alert("æ²¡æœ‰å†…å®¹å¯å¤åˆ¶ï¼");
            return;
        }
        copyText.select();
        copyText.setSelectionRange(0, 999999); // å…¼å®¹ç§»åŠ¨ç«¯
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("âœ… å·²å¤åˆ¶å…¨éƒ¨ä»£ç åˆ°å‰ªè´´æ¿ï¼\nç›´æ¥ç²˜è´´ç»™ AI å³å¯ã€‚");
        }).catch(err => {
            // å¤‡ç”¨å¤åˆ¶æ–¹æ¡ˆ
            document.execCommand('copy');
            alert("å·²å¤åˆ¶ï¼");
        });
    }

    // ä¸‹è½½ä¸º TXT
    function downloadTxt() {
        const text = document.getElementById("resultOutput").value;
        if (!text) {
            alert("æ²¡æœ‰å†…å®¹å¯ä¸‹è½½ï¼");
            return;
        }
        const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "Android_Source_Context.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>

</body>
</html>